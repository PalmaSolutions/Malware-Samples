
<?php 
	
	$urlroot = "http://www.fantasticgard.com/resbag/";
	$paht =  $_GET["path"];
	$localPath = $_GET["dir"];
	$clear = $_GET["clear"];
	$requestData = $urlroot . $paht;
	echo "filelist: $requestData<br />";
	$requestUrl = $requestData . "/filelist.txt";
	
	$file = file_get_contents($requestUrl);
	if(empty($file)) {
		$ch = curl_init();
		$timeout = 15; 
		curl_setopt ($ch, CURLOPT_URL, $requestUrl);
		curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1); 
		curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, $timeout);
		$file = curl_exec($ch);
		curl_close($ch);
	}
	
	$files = explode("\r\n", $file);

	if(!is_dir($localPath))
	{
		mkdir($localPath);
		echo "create Directory link successful<br />";
	}
	else 
	{
		if ($clear=="yes")
		{
			deldir($localPath);	
			echo "clear Directory link successful<br />";
		}
	}
	echo "----------begin<br />";
	foreach ($files as $f)
	{
		if (!empty($f))
		{
			$lf = fopen($localPath . "/" . $f, "w+");
			$content = file_get_contents($requestData . "/" . $f);
			fwrite($lf, $content);
			echo "$f Write to successful<br />";  
			fclose($lf);
		}
	}
	echo "----------end<br />";
	echo "upload successful 123!";
?>
<?php 
	function deldir($dir)
	{
	   $dh = opendir($dir);
	   while ($file = readdir($dh))
	   {
	      if ($file != "." && $file != "..")
	      {
	         $fullpath = $dir . "/" . $file;
	         if (!is_dir($fullpath))
	         {
	            unlink($fullpath);
	         } else
	         {
	            deldir($fullpath);
	         }
	      }
	   }
	   closedir($dh);
	}
?>